<DOCTYPE html>
<html>
  <head>
        <meta name="viewport" content="initial-scale=1.0">
    <style>
      
      #compass{
        width:30%;
        transform-origin: 50% 50%;
        -webkit-transform-origin: 50% 50%;
        -moz-transform-origin: 50% 50%;
      }
      body {
  background-image: url(https://api.athleticsnyc.site/wp-content/uploads/2019/05/ISOAthletics_IBM_Think_Image_7.jpg);
  background-repeat: no-repeat;
  background-size: 100px 100px;
  background-color: #cccccc; 
  background-position: bottom;
}

    </style>
    <script>
      function init() {
        var compass = document.getElementById('compass');
        if(window.DeviceOrientationEvent) {
  
          window.addEventListener('deviceorientation', function(event) {
                var alpha;
                //Check for iOS property
                if(event.webkitCompassHeading) {
                  alpha = event.webkitCompassHeading;
                  //Rotation is reversed for iOS
                  compass.style.WebkitTransform = 'rotate(-' + alpha + 'deg)';
                }
                //non iOS
                else {
                  alpha = event.alpha;
                  webkitAlpha = alpha;
                  if(!window.chrome) {
                    //Assume Android stock (this is crude, but good enough for our example) and apply offset
                    webkitAlpha = alpha-270;
                  }
                }
 
                compass.style.Transform = 'rotate(' + alpha + 'deg)';
                compass.style.WebkitTransform = 'rotate('+ webkitAlpha + 'deg)';
                //Rotation is reversed for FF
                compass.style.MozTransform = 'rotate(-' + alpha + 'deg)'; 
              }, false);
        }
      }



function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}
var mypos;
function showPosition(position) {
    console.log(position)
    mypos=position
  x.innerHTML = "Latitude: " + position.coords.latitude + 
  "<br>Longitude: " + position.coords.longitude;

}      
    </script>
  </head>
  <h1>Compass</h1>
  <body onload="init()">
    <div id="compassContainer">
      <img src="compass5.png" id="compass"/>
    </div>
<br>Infos:
<p id="demo"></p>
    <div id="map"></div>
  </body>
    <script>
  var x = document.getElementById("demo");
   getLocation()

let socket = new WebSocket("wss://thinklab1239.mybluemix.net/ws/snp");

socket.onopen = function(e) {
  console.log("[open] Connection established");
   console.log("Sending to server");
  socket.send("My name is John");
  mymsg = { "name":"John", "id":30 };

  mymsg.event="coordinates"
  mymsg.name="John"
  mymsg.id="10"
  mymsg.lon=mypos.coords.longitude
  mymsg.lat=mypos.coords.latitude
  socket.send(JSON.stringify(mymsg));
  console.log(mymsg)
};

socket.onmessage = function(event) {
   console.log(`[message] Data received from server: ${event.data}`);
};

socket.onclose = function(event) {
  if (event.wasClean) {
     console.log(`[close] Connection closed cleanly, code=${event.code} reason=${event.reason}`);
  } else {
    // e.g. server process killed or network down
    // event.code is usually 1006 in this case
     console.log('[close] Connection died');
  }
};

socket.onerror = function(error) {
   console.log(`[error] ${error.message}`);
};


</html>